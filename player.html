<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Video Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, var(--bg1, #0a0a2a) 0%, var(--bg2, #1a0033) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text, #fff);
        }
        .stars {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        .container {
            position: relative; z-index: 1;
            max-width: 900px; margin: 0 auto; padding: 20px;
        }
        .header { text-align: center; margin-bottom: 20px; }
        
        /* Glitch effect –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
        .title {
            color: var(--text, #fff);
            font-family: 'Fredoka', cursive;
            font-size: 2.2em; font-weight: 700;
            text-shadow: 0 0 20px var(--primary, #00ffff), 0 0 40px var(--secondary, #0080ff);
            margin-bottom: 10px;
            position: relative;
        }
        .title.glitch {
            animation: glitch 2s infinite;
        }
        .title.glitch::before, .title.glitch::after {
            content: attr(data-text);
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
        }
        .title.glitch::before {
            left: 2px; text-shadow: -2px 0 #ff00c1;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        .title.glitch::after {
            left: -2px; text-shadow: -2px 0 #00fff9;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            92% { transform: translate(-2px, 2px); }
            94% { transform: translate(2px, -2px); }
            96% { transform: translate(-2px, -2px); }
            98% { transform: translate(2px, 2px); }
        }
        @keyframes glitch-anim {
            0% { clip: rect(30px, 9999px, 10px, 0); }
            20% { clip: rect(80px, 9999px, 90px, 0); }
            40% { clip: rect(10px, 9999px, 60px, 0); }
            60% { clip: rect(50px, 9999px, 20px, 0); }
            80% { clip: rect(20px, 9999px, 80px, 0); }
            100% { clip: rect(70px, 9999px, 40px, 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip: rect(10px, 9999px, 80px, 0); }
            20% { clip: rect(60px, 9999px, 20px, 0); }
            40% { clip: rect(90px, 9999px, 40px, 0); }
            60% { clip: rect(30px, 9999px, 70px, 0); }
            80% { clip: rect(50px, 9999px, 10px, 0); }
            100% { clip: rect(80px, 9999px, 60px, 0); }
        }
        
        .restart-btn {
            background: linear-gradient(135deg, var(--wrong, #ff6b6b), var(--wrong, #ff4757));
            color: white; border: none; border-radius: 50px;
            padding: 12px 24px; font-family: 'Fredoka', cursive;
            font-size: 1em; font-weight: 600; cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
            transition: all 0.3s;
        }
        .restart-btn:hover { transform: scale(1.1); }
        
        .score-container {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px; backdrop-filter: blur(10px);
        }
        .score {
            color: #ffd700; font-family: 'Fredoka', cursive;
            font-size: 1.5em; font-weight: 700;
        }
        
        .video-container {
            position: relative; border-radius: 20px;
            overflow: hidden; box-shadow: 0 10px 50px rgba(0, 255, 255, 0.3);
            margin-bottom: 20px; background: #000;
        }
        
        /* –í–∏–¥–µ–æ –∏ iframe */
        video, .video-iframe {
            width: 100%; display: block; background: #000;
            aspect-ratio: 16/9;
        }
        .video-iframe iframe {
            width: 100%; height: 100%; border: none;
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–∫–æ–Ω–∫–æ–π */
        .progress-container {
            position: relative; height: 30px;
            background: rgba(0, 0, 0, 0.5); border-radius: 15px;
            overflow: hidden; margin-bottom: 20px;
            border: 2px solid var(--primary, #00ffff);
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary, #00d4ff), var(--secondary, #0080ff), var(--primary, #00ffff));
            width: 0%; transition: width 0.3s; position: relative;
        }
        .progress-icon {
            position: absolute; right: -20px; top: 50%;
            transform: translateY(-50%); font-size: 1.8em;
            transition: right 0.3s;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –∏–∫–æ–Ω–∫–∏ */
        .progress-icon.bounce { animation: bounce 1s infinite; }
        .progress-icon.spin { animation: spin 2s linear infinite; }
        .progress-icon.pulse { animation: pulse 1s infinite; }
        .progress-icon.swing { animation: swing 1s ease-in-out infinite; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-70%) scale(1.2); }
        }
        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.3); }
        }
        @keyframes swing {
            0%, 100% { transform: translateY(-50%) rotate(0deg); }
            25% { transform: translateY(-50%) rotate(15deg); }
            75% { transform: translateY(-50%) rotate(-15deg); }
        }
        
        .quiz-overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none; align-items: center; justify-content: center;
            z-index: 10;
        }
        .quiz-box {
            background: linear-gradient(135deg, rgba(74, 0, 224, 0.9), rgba(142, 45, 226, 0.9));
            border: 3px solid var(--primary, #00ffff);
            border-radius: 30px; padding: 30px;
            max-width: 500px; width: 90%;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.6);
        }
        .question-number {
            color: #ffd700; font-family: 'Fredoka', cursive;
            font-size: 1.3em; font-weight: 600;
            margin-bottom: 15px; text-align: center;
        }
        .question-text {
            color: white; font-family: 'Nunito', sans-serif;
            font-size: 1.5em; font-weight: 700;
            margin-bottom: 25px; text-align: center;
        }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--primary, #00ffff);
            border-radius: 50px; padding: 18px 28px;
            color: white; font-family: 'Nunito', sans-serif;
            font-size: 1.2em; font-weight: 700;
            cursor: pointer; transition: all 0.3s; text-align: left;
        }
        .option-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateX(10px);
        }
        .option-btn.correct {
            background: linear-gradient(135deg, var(--correct, #00ff88), var(--correct, #00cc66));
            border-color: var(--correct, #00ff88);
        }
        .option-btn.wrong {
            background: linear-gradient(135deg, var(--wrong, #ff4757), var(--wrong, #ff3838));
            border-color: var(--wrong, #ff4757);
        }
        
        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ */
        .text-input-container {
            margin-top: 15px;
        }
        .text-input {
            width: 100%; padding: 15px;
            border: 2px solid var(--primary, #00ffff);
            border-radius: 10px; background: rgba(0,0,0,0.3);
            color: white; font-family: 'Nunito', sans-serif;
            font-size: 1.1em; margin-bottom: 10px;
        }
        .text-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(0,255,255,0.5);
        }
        .submit-btn {
            background: linear-gradient(135deg, var(--btn, #667eea), var(--secondary, #764ba2));
            color: white; border: none; border-radius: 50px;
            padding: 12px 30px; font-family: 'Fredoka', cursive;
            font-size: 1em; font-weight: 700; cursor: pointer;
            width: 100%; transition: all 0.3s;
        }
        .submit-btn:hover { transform: scale(1.05); }
        
        .hint-box {
            position: absolute; top: 20px; left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--wrong, #ff6b6b), var(--wrong, #ff8e53));
            color: white; padding: 18px 35px; border-radius: 20px;
            font-family: 'Nunito', sans-serif; font-size: 1.3em;
            font-weight: 700; z-index: 15; display: none;
        }
        .confetti-container {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 20;
        }
        .confetti {
            position: absolute; width: 10px; height: 10px;
            background: #ffd700; animation: fall 3s linear;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .loading {
            display: flex; align-items: center; justify-content: center;
            height: 100vh; color: var(--text, #fff); font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div class="stars" id="starfield"></div>
    <div class="confetti-container" id="confetti-container"></div>
    <div id="loading" class="loading">üöÄ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <div class="container" id="gameContainer" style="display: none;">
        <div class="header">
            <h1 class="title" id="gameTitle" data-text="Smart Video Player">Smart Video Player</h1>
            <button class="restart-btn" onclick="restartMission()">Replay</button>
        </div>
        <div class="score-container">
            <div class="score" id="score">Score: 0/0</div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar">
                <span class="progress-icon" id="progress-icon"></span>
            </div>
        </div>
        <div class="video-container" id="videoContainer">
            <!-- –í–∏–¥–µ–æ –∏–ª–∏ iframe –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
        <div class="hint-box" id="hint-box"></div>
        <div class="quiz-overlay" id="quiz-overlay">
            <div class="quiz-box">
                <div class="question-number" id="question-number"></div>
                <div class="question-text" id="question-text"></div>
                <div class="options" id="options"></div>
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ -->
                <div class="text-input-container" id="textInputContainer" style="display: none;">
                    <input type="text" class="text-input" id="textAnswer" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç...">
                    <button class="submit-btn" onclick="checkTextAnswer()">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const defaultConfig = {
            videoSourceType: 'direct',
            videoUrl: 'https://www.w3schools.com/html/mov_bbb.mp4',
            videoIframe: '',
            language: 'en',
            gameTitle: 'Smart Video Player',
            progressIcon: 'üöÄ',
            iconAnimation: 'none',
            questions: [],
            design: {
                bgColor1: '#0a0a2a', bgColor2: '#1a0033',
                primaryColor: '#00ffff', secondaryColor: '#0080ff',
                btnColor: '#667eea', correctColor: '#00ff88',
                wrongColor: '#ff4757', textColor: '#ffffff',
                starfield: true, glitchEffect: true
            }
        };

        let config = {};
        let currentQuestionIndex = 0;
        let score = 0;
        let questionsAsked = new Set();
        
        const videoContainer = document.getElementById('videoContainer');
        const quizOverlay = document.getElementById('quiz-overlay');
        const questionNumber = document.getElementById('question-number');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options');
        const textInputContainer = document.getElementById('textInputContainer');
        const textAnswer = document.getElementById('textAnswer');
        const progressBar = document.getElementById('progress-bar');
        const progressIcon = document.getElementById('progress-icon');
        const scoreDisplay = document.getElementById('score');
        const hintBox = document.getElementById('hint-box');
        const confettiContainer = document.getElementById('confetti-container');
        const gameContainer = document.getElementById('gameContainer');
        const loading = document.getElementById('loading');
        let videoElement = null;
        let isIframeVideo = false;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function loadConfig() {
            const urlParams = new URLSearchParams(window.location.search);
            const configParam = urlParams.get('config');
            
            if (configParam) {
                try {
                    const configJson = decodeURIComponent(escape(atob(configParam)));
                    config = JSON.parse(configJson);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', e);
                    config = { ...defaultConfig };
                }
            } else {
                config = { ...defaultConfig };
            }
            config = { ...defaultConfig, ...config, design: { ...defaultConfig.design, ...(config.design || {}) } };
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞
        function applyDesign() {
            const d = config.design || {};
            document.documentElement.style.setProperty('--bg1', d.bgColor1);
            document.documentElement.style.setProperty('--bg2', d.bgColor2);
            document.documentElement.style.setProperty('--primary', d.primaryColor);
            document.documentElement.style.setProperty('--secondary', d.secondaryColor);
            document.documentElement.style.setProperty('--btn', d.btnColor);
            document.documentElement.style.setProperty('--correct', d.correctColor);
            document.documentElement.style.setProperty('--wrong', d.wrongColor);
            document.documentElement.style.setProperty('--text', d.textColor);
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏–∫–æ–Ω–∫–∞
            progressIcon.textContent = config.progressIcon || 'üöÄ';
            progressIcon.className = 'progress-icon';
            if (config.iconAnimation && config.iconAnimation !== 'none') {
                progressIcon.classList.add(config.iconAnimation);
            }
            
            // –ì–ª–∏—Ç—á-—ç—Ñ—Ñ–µ–∫—Ç
            const title = document.getElementById('gameTitle');
            title.setAttribute('data-text', config.gameTitle);
            if (d.glitchEffect) {
                title.classList.add('glitch');
            } else {
                title.classList.remove('glitch');
            }
            
            if (d.starfield !== false) createStarfield();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–µ–æ
        function setupVideo() {
            videoContainer.innerHTML = '';
            
            if (config.videoSourceType === 'direct') {
                // –ü—Ä—è–º–æ–µ –≤–∏–¥–µ–æ MP4
                videoElement = document.createElement('video');
                videoElement.id = 'video';
                videoElement.innerHTML = `<source src="${config.videoUrl}" type="video/mp4">Your browser does not support the video tag.`;
                videoElement.style.width = '100%';
                videoContainer.appendChild(videoElement);
                isIframeVideo = false;
            } else {
                // Iframe –≤—Å—Ç–∞–≤–∫–∞
                const iframeWrapper = document.createElement('div');
                iframeWrapper.className = 'video-iframe';
                iframeWrapper.innerHTML = config.videoIframe || '<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>';
                videoContainer.appendChild(iframeWrapper);
                isIframeVideo = true;
                // –î–ª—è iframe –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ
                simulateProgressForIframe();
            }
        }
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è iframe
        function simulateProgressForIframe() {
            let progress = 0;
            const interval = setInterval(() => {
                if (quizOverlay.style.display === 'flex') return;
                progress += 0.5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    onVideoEnd();
                }
                progressBar.style.width = progress + '%';
            }, 1000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—ë–∑–¥
        function createStarfield() {
            const starfield = document.getElementById('starfield');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starfield.appendChild(star);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–¥–ª—è MP4)
        function updateProgress() {
            if (isIframeVideo || !videoElement?.duration) return;
            const progress = (videoElement.currentTime / videoElement.duration) * 100;
            progressBar.style.width = progress + '%';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –≤–æ–ø—Ä–æ—Å–æ–≤
        function checkQuizTrigger() {
            if (isIframeVideo) return;
            const currentTime = Math.floor(videoElement?.currentTime || 0);
            const questions = config.questions || [];
            
            for (let i = 0; i < questions.length; i++) {
                const quiz = questions[i];
                if (currentTime === quiz.time && !questionsAsked.has(i)) {
                    questionsAsked.add(i);
                    showQuiz(i);
                    break;
                }
            }
        }

        // –ü–æ–∫–∞–∑ –≤–æ–ø—Ä–æ—Å–∞
        function showQuiz(index) {
            if (!isIframeVideo && videoElement) videoElement.pause();
            
            currentQuestionIndex = index;
            const quiz = config.questions[index];

            questionNumber.textContent = `Question ${index + 1} of ${config.questions.length}`;
            questionText.textContent = quiz.question;
            optionsContainer.innerHTML = '';
            textInputContainer.style.display = 'none';
            textAnswer.value = '';

            if (quiz.type === 'multiple') {
                // –í–æ–ø—Ä–æ—Å —Å –≤—ã–±–æ—Ä–æ–º
                quiz.options.forEach((option, i) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = option;
                    btn.onclick = () => checkMultipleAnswer(i, quiz.correct, quiz.hint);
                    optionsContainer.appendChild(btn);
                });
            } else {
                // –í–æ–ø—Ä–æ—Å —Å –≤–≤–æ–¥–æ–º —Ç–µ–∫—Å—Ç–∞
                optionsContainer.style.display = 'none';
                textInputContainer.style.display = 'block';
                textAnswer.dataset.correct = quiz.correctAnswer;
                textAnswer.dataset.hint = quiz.hint;
                textAnswer.onkeydown = (e) => { if (e.key === 'Enter') checkTextAnswer(); };
                textAnswer.focus();
                return;
            }

            quizOverlay.style.display = 'flex';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ (–≤—ã–±–æ—Ä)
        function checkMultipleAnswer(selectedIndex, correctLetter, hint) {
            const buttons = optionsContainer.children;
            const selectedText = config.questions[currentQuestionIndex].options[selectedIndex];
            const selectedLetter = selectedText.split(')')[0].trim().toUpperCase();
            
            for (let btn of buttons) { btn.disabled = true; btn.style.cursor = 'not-allowed'; }

            if (selectedLetter === correctLetter.toUpperCase()) {
                buttons[selectedIndex].classList.add('correct');
                score++;
                scoreDisplay.textContent = `‚≠ê Stars: ${score}/${config.questions.length}`;
                createConfetti();
                setTimeout(() => {
                    quizOverlay.style.display = 'none';
                    optionsContainer.style.display = 'flex';
                    if (!isIframeVideo && videoElement) videoElement.play();
                }, 2000);
            } else {
                buttons[selectedIndex].classList.add('wrong');
                for (let i = 0; i < buttons.length; i++) {
                    const btnText = config.questions[currentQuestionIndex].options[i];
                    const btnLetter = btnText.split(')')[0].trim().toUpperCase();
                    if (btnLetter === correctLetter.toUpperCase()) {
                        buttons[i].classList.add('correct');
                        break;
                    }
                }
                hintBox.textContent = hint;
                hintBox.style.display = 'block';
                setTimeout(() => {
                    hintBox.style.display = 'none';
                    quizOverlay.style.display = 'none';
                    optionsContainer.style.display = 'flex';
                    if (!isIframeVideo && videoElement) videoElement.play();
                }, 3000);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ (—Ç–µ–∫—Å—Ç)
        function checkTextAnswer() {
            const userAnswer = textAnswer.value.trim().toLowerCase();
            const correctAnswer = textAnswer.dataset.correct.toLowerCase();
            const hint = textAnswer.dataset.hint;
            
            textAnswer.disabled = true;
            document.querySelector('.submit-btn').disabled = true;

            if (userAnswer === correctAnswer) {
                textAnswer.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--correct');
                score++;
                scoreDisplay.textContent = `‚≠ê Stars: ${score}/${config.questions.length}`;
                createConfetti();
                setTimeout(() => {
                    quizOverlay.style.display = 'none';
                    textInputContainer.style.display = 'none';
                    optionsContainer.style.display = 'flex';
                    textAnswer.disabled = false;
                    document.querySelector('.submit-btn').disabled = false;
                    if (!isIframeVideo && videoElement) videoElement.play();
                }, 2000);
            } else {
                textAnswer.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--wrong');
                hintBox.textContent = hint;
                hintBox.style.display = 'block';
                setTimeout(() => {
                    hintBox.style.display = 'none';
                    quizOverlay.style.display = 'none';
                    textInputContainer.style.display = 'none';
                    optionsContainer.style.display = 'flex';
                    textAnswer.value = '';
                    textAnswer.disabled = false;
                    textAnswer.style.borderColor = '';
                    document.querySelector('.submit-btn').disabled = false;
                    if (!isIframeVideo && videoElement) videoElement.play();
                }, 3000);
            }
        }

        // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏
        function createConfetti() {
            const colors = ['#9b59b6', '#3498db', '#c0c0c0', '#ffd700', '#00ffff'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confettiContainer.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
        function restartMission() {
            if (!isIframeVideo && videoElement) videoElement.currentTime = 0;
            score = 0;
            questionsAsked.clear();
            scoreDisplay.textContent = `‚≠ê Stars: 0/${config.questions.length}`;
            quizOverlay.style.display = 'none';
            hintBox.style.display = 'none';
            textInputContainer.style.display = 'none';
            optionsContainer.style.display = 'flex';
            progressBar.style.width = '0%';
            if (!isIframeVideo && videoElement) videoElement.play();
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–∏–¥–µ–æ
        function onVideoEnd() {
            alert(`üéâ –û—Ç–ª–∏—á–Ω–æ! –í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score}/${config.questions.length} ‚≠ê`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            loadConfig();
            applyDesign();
            setupVideo();
            
            // –°–æ–±—ã—Ç–∏—è –¥–ª—è MP4 –≤–∏–¥–µ–æ
            if (!isIframeVideo && videoElement) {
                videoElement.addEventListener('timeupdate', () => {
                    updateProgress();
                    checkQuizTrigger();
                });
                videoElement.addEventListener('ended', onVideoEnd);
                videoElement.load();
            }
            
            loading.style.display = 'none';
            gameContainer.style.display = 'block';
            scoreDisplay.textContent = `‚≠ê Stars: 0/${config.questions.length}`;
            
            document.addEventListener('click', () => {
                if (!isIframeVideo && videoElement?.paused && quizOverlay.style.display !== 'flex') {
                    videoElement.play().catch(() => {});
                }
            }, { once: true });
        }

        init();
    </script>
</body>
</html>
